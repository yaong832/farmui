# 🌐 AI 농장 데이터 분석 시스템 웹 사용 가이드

## 📋 목차
1. [시스템 소개](#시스템-소개)
2. [접속 방법](#접속-방법)
3. [화면 구성](#화면-구성)
4. [기능 설명](#기능-설명)
5. [AI 사용 방법](#ai-사용-방법)
6. [API 사용법](#api-사용법)

---

## 🎯 시스템 소개

**AI 농장 데이터 분석 시스템**은 스마트팜의 센서 데이터를 실시간으로 모니터링하고, AI를 활용하여 데이터 분석, 이상 징후 감지, 생산량 예측을 제공하는 웹 기반 대시보드입니다.

### 주요 기능
- 📊 **실시간 센서 데이터 모니터링**: 습도, 온도, 채광, 토양습도
- 🤖 **AI 기반 데이터 분석**: 평균 데이터 분석, 이상 징후 감지, 생산량 예측
- 📈 **작물별 맞춤 분석**: 각 농장의 작물에 최적화된 AI 분석
- 📝 **데이터 로그 관리**: 시간별 센서 데이터 로그 저장 및 조회

---

## 🔌 접속 방법

### 1. Flask 서버 실행

#### 방법 1: PyCharm에서 실행
1. PyCharm에서 `C:\farmui` 프로젝트 열기
2. `app.py` 파일 열기
3. `Run` → `Run 'app'` 또는 `Shift + F10`
4. 서버가 시작되면 자동으로 브라우저가 열림

#### 방법 2: 터미널에서 실행
```bash
cd C:\farmui
python app.py
```

#### 방법 3: 배치 파일 실행 (Windows)
```bash
cd C:\farmui
run_flask.bat
```

### 2. 웹 브라우저 접속
- **URL**: `http://localhost:5000`
- 서버가 실행되면 자동으로 브라우저가 열립니다
- 수동으로 접속하려면 브라우저에서 위 URL 입력

### 3. 서버 상태 확인
- 서버가 정상 실행되면 터미널에 다음 메시지가 표시됩니다:
```
💾 메모리 모드로 실행 중... (DB 사용 안 함)
🌐 브라우저를 엽니다: http://localhost:5000
==================================================
Flask 웹 서버를 시작합니다...
서버 주소: http://localhost:5000
==================================================
 * Running on http://0.0.0.0:5000
```

---

## 📱 화면 구성

### 1. 헤더 바 (상단)
- **왼쪽**: "AI 농장 데이터 분석 시스템" 제목
- **오른쪽**: 설정 아이콘 (⚙️), 홈 아이콘 (🏠)

### 2. 왼쪽 패널 - 데이터 로그
- **제목**: "데이터 로그"
- **내용**: 실시간 센서 데이터 로그
- **형식**: `[2025. 11. 3. 오후 7:59:29] 온도: 24.6°C, 습도: 78.4%, 토양 습도: 63.2%`
- **자동 업데이트**: 2초마다 자동으로 새 데이터 추가
- **스크롤**: 최신 데이터가 위에 표시되며, 최대 50개 유지

### 3. 오른쪽 사이드바

#### 상단: AI 품질 분석 섹션
- **제목**: "AI 품질 분석"
- **평균 데이터 표시**:
  - 온도 평균값
  - 습도 평균값
  - 토양 습도 평균값
- **자동 계산**: 최근 10개 로그 데이터의 평균값

#### 중간: AI 분석 버튼
- **평균 데이터 분석** (📊)
- **이상 징후 감지** (⚠️)
- **생산량 예측** (📈)

#### 하단: 결과 표시 영역
- AI 분석 결과가 표시되는 영역
- 버튼 클릭 시 활성화
- 스크롤 가능

---

## 🔧 기능 설명

### 1. 실시간 데이터 모니터링

#### 데이터 로그 자동 업데이트
- **주기**: 2초마다 자동 업데이트
- **데이터 소스**: C# 애플리케이션에서 전송된 센서 데이터
- **표시 형식**:
  ```
  [2025. 11. 3. 오후 7:59:29]
  온도: 24.6°C, 습도: 78.4%, 토양 습도: 63.2%
  ```

#### 평균 데이터 자동 계산
- **계산 기준**: 최근 10개 로그 데이터
- **표시 항목**:
  - 온도 평균 (°C)
  - 습도 평균 (%)
  - 토양 습도 평균 (%)

---

### 2. AI 분석 기능

#### 📊 평균 데이터 분석
**기능:**
- 최근 N일(기본 7일) 센서 데이터 통계 분석
- 작물별 최적 조건과 비교
- 각 센서의 평균, 최소, 최대값 계산
- 환경 점수 계산 (0~100%)

**사용 방법:**
1. 오른쪽 사이드바에서 "평균 데이터 분석" 버튼 클릭
2. 결과가 하단 결과 영역에 표시됨

**결과 내용:**
- 분석 기간 및 데이터 수
- 전체 환경 점수
- 각 센서별 분석:
  - 평균값, 최소값, 최대값
  - 작물 재배 최적 범위
  - 현재 상태 (최적/양호/주의/위험)
  - 최적 점수 (0~100%)
- 작물별 맞춤 추천사항

**예시 결과:**
```
🍎 사과 재배 평균 데이터 분석 결과
분석 기간: 최근 7일
데이터 수: 500개
전체 환경 점수: 93.3%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 습도 분석:
  평균: 65.32% (최소: 52.10%, 최대: 78.40%)
  사과 재배 최적 범위: 60-80%
  현재 상태: 최적 (점수: 95.0%)

🌡️ 온도 분석:
  평균: 22.15℃ (최소: 18.50℃, 최대: 28.90℃)
  사과 재배 최적 범위: 15-25℃
  현재 상태: 최적 (점수: 98.2%)

💡 사과 재배 개선 추천사항:
1. ✅ 현재 환경 조건이 사과 재배에 매우 우수합니다. 현재 상태를 유지하세요.
```

---

#### ⚠️ 이상 징후 감지
**기능:**
- 작물별 최적 조건 위반 감지
- 통계적 이상치 감지 (Z-score 기반)
- 심각도 분류 (높음/중간)
- 이상 징후 원인 분석

**사용 방법:**
1. 오른쪽 사이드바에서 "이상 징후 감지" 버튼 클릭
2. 결과가 하단 결과 영역에 표시됨

**결과 내용:**
- 총 이상 징후 개수
- 심각도별 분류 (위험/주의)
- 센서별 이상 징후 현황
- 주요 이상 징후 목록 (최대 10개)
- 각 이상 징후의 상세 정보:
  - 발생 시간
  - 센서값
  - 원인
  - 작물 최적 범위

**예시 결과:**
```
⚠️ 사과 재배 이상 징후 감지 결과
분석 기간: 최근 7일
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

총 이상 징후: 5개
  🔴 위험 (높음): 2개
  🟡 주의 (중간): 3개

센서별 이상 징후 현황:
  습도 이상: 1개
  온도 이상: 2개
  채광 이상: 1개
  토양습도 이상: 1개

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
주요 이상 징후 목록:

🔴 1. 온도
   시간: 2025-11-03 14:30:00
   값: 38.50℃
   원인: 위험 범위 초과 (사과 재배 최대값 35℃ 초과)
   사과 최적 범위: 15-25℃
```

---

#### 📈 생산량 예측
**기능:**
- 작물별 생산량 예측 (kg 단위)
- 환경 점수 기반 생산량 조정
- 신뢰구간 제공 (최소~최대 예측 범위)
- 예측 신뢰도 계산

**사용 방법:**
1. 오른쪽 사이드바에서 "생산량 예측" 버튼 클릭
2. 결과가 하단 결과 영역에 표시됨

**결과 내용:**
- 예측 생산량
- 예측 범위 (신뢰구간)
- 환경 점수
- 예측 신뢰도
- 생산량 계수
- 생산량 향상을 위한 추천사항

**예시 결과:**
```
📈 사과 생산량 예측 결과
예측 기간: 7일
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🍎 예측 생산량:
  5234.56kg

📊 예측 범위 (신뢰구간):
  최소: 4187.65kg
  최대: 6281.47kg

📈 환경 점수: 93.3%
🎯 예측 신뢰도: 89%
📦 생산량 계수: 1.16x

✅ 현재 환경 조건이 매우 우수하여 예상 생산량의 100% 이상을 기대할 수 있습니다.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💡 생산량 향상을 위한 추천사항:
1. ✅ 환경 조건이 매우 우수합니다. 현재 상태를 유지하면 사과의 품질과 수확량이 최대화될 것입니다.
```

---

## 🤖 AI 사용 방법

### 1. 기본 사용 흐름

#### Step 1: C# 애플리케이션과 연결
1. C# 애플리케이션 실행
2. "웹 연결" 버튼 클릭
3. 센서 데이터가 Flask 서버로 전송됨
4. 웹 페이지에서 실시간 데이터 확인

#### Step 2: 데이터 수집 확인
1. 왼쪽 패널에서 데이터 로그 확인
2. 2초마다 새 데이터가 자동 추가됨
3. 최소 10개 이상의 데이터 수집 후 AI 분석 권장

#### Step 3: AI 분석 실행
1. 원하는 AI 기능 버튼 클릭
2. 분석 결과 확인
3. 추천사항 확인 및 적용

---

### 2. 작물별 맞춤 분석

#### 작물 정보 설정
1. C# 애플리케이션에서 `FarmManageForm` 실행
2. 각 농장(1~3번)의 작물 정보 설정
   - 작물 이름 (예: "사과", "토마토", "상추")
   - 작물 설명 및 최적 조건 (선택사항)
3. Flask 서버가 자동으로 작물 정보를 인식
4. 해당 작물의 최적 조건으로 AI 분석 수행

#### 작물별 최적 조건
현재 지원 작물:
- **사과**: 온도 15-25℃, 습도 60-80%
- **토마토**: 온도 20-25℃, 습도 50-70%
- **상추**: 온도 18-22℃, 습도 60-75%
- **기본**: 일반 작물 기준 (작물 정보 없을 때)

#### 새 작물 추가 방법
1. `C:\farmui\crop_config.py` 파일 열기
2. `CROP_OPTIMAL_CONDITIONS` 딕셔너리에 새 작물 추가
3. Flask 서버 재시작
4. C# 애플리케이션에서 새 작물 이름 설정

---

### 3. AI 분석 결과 해석

#### 환경 점수 (Overall Score)
- **90% 이상**: 매우 우수한 환경 조건
- **70~90%**: 양호한 환경 조건
- **50~70%**: 보통 수준의 환경 조건
- **50% 미만**: 부적합한 환경 조건

#### 상태 판정
- **최적**: 작물 재배 최적 범위 내
- **양호**: 허용 가능 범위 내
- **주의**: 허용 범위 밖, 위험 범위 전
- **위험**: 위험 범위 밖

#### 이상 징후 심각도
- **높음 (위험)**: 즉시 조치 필요
- **중간 (주의)**: 모니터링 및 예방 조치 권장

---

## 📡 API 사용법

### 1. 센서 데이터 API

#### GET `/api/sensors`
**설명**: 최신 센서 데이터 조회

**요청 예시:**
```bash
curl http://localhost:5000/api/sensors
```

**응답 예시:**
```json
{
  "currentFarm": 1,
  "powerOn": true,
  "connected": true,
  "lastUpdate": "2025-11-03T14:30:00",
  "sensors": [
    {
      "name": "습도",
      "rawValue": 65.3,
      "displayValue": "65.3%"
    },
    {
      "name": "온도",
      "rawValue": 22.1,
      "displayValue": "22.1°C"
    }
  ]
}
```

---

### 2. AI 분석 API

#### GET `/api/ai/average?days=7`
**설명**: 평균 데이터 분석

**파라미터:**
- `days` (선택): 분석할 기간 (일), 기본값: 7

**요청 예시:**
```bash
curl http://localhost:5000/api/ai/average?days=7
```

**응답 예시:**
```json
{
  "success": true,
  "period_days": 7,
  "data_count": 500,
  "crop_type": "사과",
  "overall_score": 0.933,
  "humidity": {
    "average": 65.32,
    "min": 52.10,
    "max": 78.40,
    "optimal_score": 0.95,
    "status": "최적"
  },
  "recommendations": [
    "✅ 현재 환경 조건이 사과 재배에 매우 우수합니다."
  ]
}
```

---

#### GET `/api/ai/anomaly?days=7`
**설명**: 이상 징후 감지

**파라미터:**
- `days` (선택): 분석할 기간 (일), 기본값: 7

**요청 예시:**
```bash
curl http://localhost:5000/api/ai/anomaly?days=7
```

**응답 예시:**
```json
{
  "success": true,
  "total_anomalies": 5,
  "critical_count": 2,
  "warning_count": 3,
  "crop_type": "사과",
  "anomalies": [
    {
      "sensor": "온도",
      "timestamp": "2025-11-03T14:30:00",
      "value": 38.5,
      "severity": "높음",
      "reason": "위험 범위 초과"
    }
  ]
}
```

---

#### GET `/api/ai/prediction?days=7`
**설명**: 생산량 예측

**파라미터:**
- `days` (선택): 분석할 기간 (일), 기본값: 7

**요청 예시:**
```bash
curl http://localhost:5000/api/ai/prediction?days=7
```

**응답 예시:**
```json
{
  "success": true,
  "crop_type": "사과",
  "prediction": {
    "predicted_production": 5234.56,
    "lower_bound": 4187.65,
    "upper_bound": 6281.47,
    "unit": "kg",
    "confidence": 0.89,
    "environment_score": 0.933
  },
  "recommendations": [
    "✅ 환경 조건이 매우 우수합니다."
  ]
}
```

---

### 3. 작물 목록 API

#### GET `/api/crops`
**설명**: 사용 가능한 작물 목록 조회

**요청 예시:**
```bash
curl http://localhost:5000/api/crops
```

**응답 예시:**
```json
{
  "success": true,
  "total": 3,
  "crops": [
    {
      "name": "사과",
      "description": "사과 재배 - 생육기 최적 온도 15-25℃, 습도 60-80%",
      "conditions": {
        "humidity": "60-80%",
        "temperature": "15-25℃",
        "light": "60-80%",
        "soil_moisture": "40-60%"
      }
    }
  ]
}
```

---

### 4. 센서 데이터 전송 API

#### POST `/api/sensor-data`
**설명**: C# 애플리케이션에서 센서 데이터 전송

**요청 형식:**
```json
{
  "currentFarm": 1,
  "powerOn": true,
  "connected": true,
  "lastUpdate": "2025-11-03T14:30:00",
  "sensors": [
    {
      "name": "습도",
      "rawValue": 65.3
    }
  ]
}
```

**응답 예시:**
```json
{
  "success": true,
  "message": "센서 데이터 수신 완료"
}
```

---

## 💡 사용 팁

### 1. 효과적인 AI 분석
- **충분한 데이터 수집**: 최소 10개 이상의 데이터 로그 후 분석
- **정기적인 분석**: 주 1~2회 이상 분석 권장
- **작물 정보 설정**: 정확한 작물 정보 설정으로 더 정확한 분석

### 2. 이상 징후 대응
- **위험 (높음)**: 즉시 조치 필요
- **주의 (중간)**: 모니터링 강화 및 예방 조치
- **추천사항 확인**: AI가 제시한 구체적 개선 방안 적용

### 3. 생산량 예측 활용
- **환경 점수 확인**: 높은 환경 점수 = 높은 생산량 예측
- **신뢰구간 활용**: 예측 범위 내에서 계획 수립
- **개선 방안 적용**: 추천사항으로 환경 점수 향상

---

## ❓ 문제 해결

### 1. 데이터가 표시되지 않을 때
- **확인 사항**:
  1. C# 애플리케이션이 실행 중인지 확인
  2. "웹 연결" 버튼이 클릭되었는지 확인
  3. Flask 서버가 정상 실행 중인지 확인
  4. 브라우저 콘솔에서 오류 확인 (F12)

### 2. AI 분석이 작동하지 않을 때
- **확인 사항**:
  1. 충분한 데이터가 수집되었는지 확인 (최소 10개)
  2. 센서 데이터가 정상적으로 전송되고 있는지 확인
  3. 작물 정보가 올바르게 설정되었는지 확인

### 3. 작물 정보가 반영되지 않을 때
- **확인 사항**:
  1. C# 애플리케이션에서 작물 정보가 저장되었는지 확인
  2. Flask 서버를 재시작
  3. `/api/farm` API로 작물 정보 확인

---

## 📞 지원 및 추가 정보

### 관련 파일
- **Flask 서버**: `C:\farmui\app.py`
- **AI 분석 모듈**: `C:\farmui\ai_analysis.py`
- **작물 설정**: `C:\farmui\crop_config.py`
- **웹 UI**: `C:\farmui\templates\index.html`

### 추가 문서
- **AI 학습 전략**: `C:\farmui\ai_learning_strategy.md`
- **PyCharm 설정**: `C:\farmui\README_PYCHARM.md`

---

**마지막 업데이트**: 2025-11-03
**버전**: 1.0

